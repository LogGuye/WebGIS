{% extends "base.html" %}
{% block title %}Nearby Search{% endblock %}
{% block content %}
<h2>Tìm BĐS gần vị trí</h2>
<form method="get" class="row g-2 align-items-end mb-3">
    <div class="col-md-3">
        <label class="form-label">Latitude</label>
        <input type="text" name="lat" class="form-control" value="{{ params.lat }}">
    </div>
    <div class="col-md-3">
        <label class="form-label">Longitude</label>
        <input type="text" name="lng" class="form-control" value="{{ params.lng }}">
    </div>
    <div class="col-md-2">
        <label class="form-label">Bán kính (km)</label>
        <input type="number" step="0.1" name="radius" class="form-control" value="{{ params.radius }}">
    </div>
    <div class="col-md-2">
        <label class="form-label">Loại BĐS</label>
        <select name="type" class="form-select">
            <option value="">Tất cả</option>
            <option value="apartment" {% if params.type == "apartment" %}selected{% endif %}>Apartment</option>
            <option value="house" {% if params.type == "house" %}selected{% endif %}>House</option>
            <option value="land" {% if params.type == "land" %}selected{% endif %}>Land</option>
        </select>
    </div>
    <div class="col-md-2">
        <button class="btn btn-primary w-100">Tìm kiếm</button>
    </div>
</form>

{% if results != None %}
    <p class="text-muted">Tìm thấy {{ results|length }} BĐS.</p>
    <div class="list-group">
        {% for p in results %}
        <div class="list-group-item d-flex justify-content-between align-items-center">
            <div>
                <h6 class="mb-1">{{ p.title }}</h6>
                <small>{{ p.address }}</small><br>
                <small class="text-muted">{{ p.get_property_type_display }} · {{ p.area }} m²</small>
            </div>
            <span class="badge text-bg-primary">{{ p.distance.km|floatformat:2 }} km</span>
            <a class="btn btn-sm btn-outline-secondary" href="{% url 'properties:detail' p.pk %}">Xem</a>
        </div>
        {% empty %}
        <p>Không có kết quả.</p>
        {% endfor %}
    </div>
{% endif %}
{% endblock %}
